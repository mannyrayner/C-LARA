{# templates/clara_app/manage_content_passwords.html #}
{% extends "clara_app/base.html" %}
{% load humanize %}

{% block content %}
  <h2>Content Password Manager</h2>
  <p>Manage passwords for content published from projects you own.</p>

  {% if protected_contents %}
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Project</th>
          <th>Last Set</th>
          <th>Hint</th>
          <th>Change Password</th>
          <th>Clear</th>
        </tr>
      </thead>
      <tbody>
      {% for c in protected_contents %}
        <tr>
          <td><a href="{{ c.get_absolute_url }}">{{ c.title }}</a></td>
          <td>{{ c.project.title }}</td>
          <td>
            {% if c.password_last_set %}
              {{ c.password_last_set|naturaltime }}
            {% else %}
              â€”
            {% endif %}
          </td>
          <td>{{ c.password_hint|default:"(no hint)" }}</td>
          <td>
            <form method="post" action="{% url 'set_content_password' %}">
              {% csrf_token %}
              {{ forms_by_id.c.id }}
              <input type="hidden" name="content_id" value="{{ c.id }}">
              <input type="password" name="password" placeholder="New password">
              <input type="text" name="password_hint" placeholder="Hint (optional)" value="{{ c.password_hint|default_if_none:'' }}">
              <button type="submit">Save</button>
            </form>
          </td>
          <td>
            <form method="post" action="{% url 'clear_content_password' %}">
              {% csrf_token %}
              <input type="hidden" name="content_id" value="{{ c.id }}">
              <button type="submit" onclick="return confirm('Remove password for {{ c.title|escapejs }}?')">
                Clear
              </button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No password-protected content found for your projects.</p>
  {% endif %}
{% endblock %}
